<%= link_to "x", "#", class: "close_lightbox close_button" %>
<h1><%= @this_member.new_record? ? "Create A" : "Edit" %> Member</h1>

<div class="content">
	
	<% if @this_member.new_record? %>
		<p><%= link_to "Click here to import a CSV or Excel file.", "#", class: "show_import_fields" %></p>
	<% end %>
	
	<%= form_for @org, url: import_path(@org), method: :post, html: { class: "import_fields", target: "iframe" } do |f| %>
		<div class="field">
			<%= f.label :members_import, "Choose a CSV or Excel file to import", class: "label"%>
			<%= f.file_field :members_import %>
		</div>
		
		<p class="warn contact_error" style="display: none; ">
			Friendly Reminder: If a contact already exists in your database, we will merge their new data with their current data.
		</p>
		
		<div class="actions">
			<%= button_tag type: :submit, class: "big blue_bg button" do %>
				<span class="enabled">Import Contacts</span>
				<span class="disabled">Importing...</span>
			<% end %>
			
			<%= link_to "Close", "#", class: "close_lightbox" %>
		</div>
	<% end %>
	
	<%= form_for @this_member, url: @this_member.new_record? ? members_path(@org) : member_path(@org, @this_member), remote: true do |f| %>
		<% %w[first_name last_name email].each do |field| %>
			<div class="field">
				<%= label_tag "member[data][#{field}]", field.split("_").map{ |w| w.capitalize }.join(" "), class: "label" %>
				<%= text_field_tag "member[data][#{field}]", @this_member.data[field] %>
			</div>
		<% end %>
		

	  <div class="actions">
	    <%= submit_tag "Save Member", class: "big blue_bg button" %>
			
			<%= link_to "Close", "#", class: "close_lightbox" %>
			
			<% if @this_member != @member && @this_member.persisted? && @member.permits?(@this_member, :delete) %>
				<%= link_to "Delete", member_path(@org, @this_member), class: "close_lightbox", remote: true, method: :delete, data: { confirm: "This will delete all data associated with this member. Are you sure you want to delete this member?" } %>
			<% end %>
			
			<% if @this_member.emailable? && @member.permits?(:messages, :write) %>
				<%= link_to "Send Message", new_message_path(@org, message: { member_ids: [@this_member.id] }), remote: true %>
			<% end %>
	  </div>		
	<% end %>
</div>